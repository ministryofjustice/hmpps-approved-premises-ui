{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{%- from "moj/components/identity-bar/macro.njk" import mojIdentityBar -%}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/details/macro.njk" import govukDetails %}

{% extends "partials/layout-with-details.njk" %}

{% set pageTitle = applicationName + " - View Placement Request" %}

{% block beforeContent %}
    {{ govukBackLink({
        text: "Back",
        href: backlink
    }) }}
{% endblock %}

{% block content %}
    {% include "_messages.njk" %}

    {{ mojIdentityBar(adminIdentityBar) }}

    {% if placementRequest.isParole %}
        {% set html %}
            <p class="govuk-notification-banner__heading">
                Parole board directed release
            </p>
            <p class="govuk-body">
                The person's arrival date has been estimated
                as {{ formatDate(placementRequest.authorisedPlacementPeriod.arrival) }}.
                This is 6 weeks after the parole board's date of decision.
            </p>
            {% if changePlacementLink %}
                <p class="govuk-body">
                    If needed, you can <a href="{{ changePlacementLink }}">change the arrival date</a> in the Approved
                    Premises service.
                </p>
            {% endif %}
        {% endset %}

        {{ govukNotificationBanner({
            html: html
        }) }}
    {% endif %}


    <ul class="govuk-list govuk-!-padding-top-3 govuk-!-padding-bottom-3">
        <li>
            <a href="{{ paths.applications.show({id: placementRequest.applicationId}) }}">View application</a>
            <span class="govuk-body-s">(Completed on {{ formatDate(placementRequest.applicationDate) }})</span>
        </li>
        <li>
            <a href="{{ paths.assessments.show({id: placementRequest.assessmentId}) }}">View assessment</a>
            <span class="govuk-body-s">(Completed on {{ formatDate(placementRequest.assessmentDate) }})</span>
        </li>
    </ul>

    {{ govukSummaryList(placementRequestSummaryList) }}

    {% if placements | length > 0 %}
        <h2 class="govuk-heading-l">Booked placement{% if placements | length > 1 %}s{% endif %}</h2>

        {% for placement in placements %}
            {% set html %}
                {{ govukSummaryList({
                    rows: placement.summaryList.rows,
                    classes: 'govuk-summary-list--force-bottom-border'
                }) }}

                <p class="govuk-!-margin-top-6 govuk-!-margin-bottom-2">
                    <a href="{{ placement.link }}">View placement details</a>
                </p>
            {% endset %}

            {{ govukDetails({
                summaryHtml: '<h3>' + placement.title + '</h3>',
                html: html,
                open: 'Departed' not in placement.title,
                classes: 'govuk-details--card'
            }) }}
        {% endfor %}
    {% endif %}
{% endblock %}

